# Database Design Document
Cambridge Exam Application System - Complete Database Design

## ğŸ“Š ERå›³æ¦‚è¦

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   users     â”‚
â”‚  (ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1
       â”‚
       â”‚ N
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  applications   â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚ individual_applications â”‚
â”‚   (ç”³è¾¼æƒ…å ±)      â”‚       â”‚   (å€‹äººæˆ¦è©³ç´°)         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:1
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ team_applicationsâ”‚â”€â”€â”€â”€â”€â”€â–¶â”‚ team_members â”‚
â”‚  (ãƒãƒ¼ãƒ æˆ¦è©³ç´°)   â”‚ 1:N   â”‚ (ãƒ¡ãƒ³ãƒãƒ¼)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                          â”‚
       â”‚                          â”‚
       â–¼ 1:1                      â–¼ 1:N
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ team_scores  â”‚          â”‚ user_answers   â”‚
â”‚ (ãƒãƒ¼ãƒ é›†è¨ˆ)  â”‚          â”‚  (ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ç­”)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ N:1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  questions    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  (è©¦é¨“å•é¡Œ)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ exam_results   â”‚         â”‚ kyc_verificationsâ”‚
â”‚  (è©¦é¨“çµæœ)     â”‚         â”‚  (æœ¬äººç¢ºèªè©³ç´°)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ payment_transactionsâ”‚   â”‚ notificationsâ”‚
â”‚  (æ±ºæ¸ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³) â”‚   â”‚   (é€šçŸ¥)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ è¦ä»¶ã¨DBè¨­è¨ˆã®å¯¾å¿œè¡¨

### 1. ç”³è¾¼ãƒ»æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼

#### å€‹äººæˆ¦
| è¦ä»¶ | å¯¾å¿œãƒ†ãƒ¼ãƒ–ãƒ« | èª¬æ˜ |
|------|------------|------|
| ã‚µã‚¤ãƒˆã‹ã‚‰ç”³è¾¼ | `applications`, `individual_applications` | ç”³è¾¼æƒ…å ±ã‚’ä¿å­˜ |
| æœ¬äººç¢ºèª | `kyc_verifications` | Liquid eKYCã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ |
| Stripeæ±ºæ¸ˆ | `payment_transactions` | æ±ºæ¸ˆæƒ…å ±ã‚’è¨˜éŒ² |

#### ãƒãƒ¼ãƒ æˆ¦ï¼ˆä»£è¡¨è€…ï¼‰
| è¦ä»¶ | å¯¾å¿œãƒ†ãƒ¼ãƒ–ãƒ« | èª¬æ˜ |
|------|------------|------|
| ã‚µã‚¤ãƒˆã‹ã‚‰ç”³è¾¼ | `applications`, `team_applications`, `team_members` | ãƒ¡ãƒ³ãƒãƒ¼5ååˆ†ã‚’ç™»éŒ² |
| æœ¬äººç¢ºèª | `kyc_verifications` (application_idç´ä»˜ã‘) | ä»£è¡¨è€…ã®æœ¬äººç¢ºèª |
| Stripeæ±ºæ¸ˆ | `payment_transactions` (application_idç´ä»˜ã‘) | ä»£è¡¨è€…ã®æ±ºæ¸ˆ |

#### ãƒãƒ¼ãƒ æˆ¦ï¼ˆãƒ¡ãƒ³ãƒãƒ¼2ã€œ5ï¼‰
| è¦ä»¶ | å¯¾å¿œãƒ†ãƒ¼ãƒ–ãƒ« | èª¬æ˜ |
|------|------------|------|
| ãƒ¡ãƒ¼ãƒ«ã§æ”¯æ‰•ã„ä¾é ¼ | `email_logs` (type='payment_request') | ãƒ¡ãƒ¼ãƒ«é€ä¿¡å±¥æ­´ |
| å„è‡ªæ±ºæ¸ˆ | `team_members.payment_status`, `payment_transactions` (team_member_idç´ä»˜ã‘) | ãƒ¡ãƒ³ãƒãƒ¼å€‹åˆ¥ã®æ±ºæ¸ˆç®¡ç† |
| å„è‡ªæœ¬äººç¢ºèª | `team_members.kyc_status`, `kyc_verifications` (team_member_idç´ä»˜ã‘) | ãƒ¡ãƒ³ãƒãƒ¼å€‹åˆ¥ã®æœ¬äººç¢ºèªç®¡ç† |
| å…¨å“¡å®Œäº†ãƒã‚§ãƒƒã‚¯ | `team_applications.all_members_paid`, `all_members_kyc_completed` | è‡ªå‹•ãƒˆãƒªã‚¬ãƒ¼ã§æ›´æ–° |

---

### 2. è©¦é¨“ã‚·ã‚¹ãƒ†ãƒ 

#### å•é¡Œç®¡ç†
| è¦ä»¶ | å¯¾å¿œãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»ã‚«ãƒ©ãƒ  | èª¬æ˜ |
|------|-------------------|------|
| å•é¡Œãƒ‡ãƒ¼ã‚¿ | `questions` | å•é¡Œæ–‡ã€é¸æŠè‚¢ã€æ­£è§£ã€é…ç‚¹ |
| é›£æ˜“åº¦ãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ¼ | `questions.difficulty`, `category` | ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ç”¨ |

#### å›ç­”ãƒ»æ¡ç‚¹
| è¦ä»¶ | å¯¾å¿œãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»ã‚«ãƒ©ãƒ  | èª¬æ˜ |
|------|-------------------|------|
| ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ç­” | `user_answers` | å›ç­”å†…å®¹ã¨æ­£èª¤ |
| è§£ç­”æ™‚é–“è¨ˆæ¸¬ | `user_answers.answer_started_at`, `answer_submitted_at`, `time_taken_seconds` | å•é¡Œã”ã¨ã®è§£ç­”æ™‚é–“ |

#### ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
| è¦ä»¶ | å¯¾å¿œãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»ã‚«ãƒ©ãƒ  | èª¬æ˜ |
|------|-------------------|------|
| æ­£ç­”ç‚¹æ•° | `exam_results.total_points` | æ­£è§£æ•° Ã— é…ç‚¹ |
| è§£ç­”æ™‚é–“ | `exam_results.total_time_seconds` | å…¨ä½“ã®è§£ç­”æ™‚é–“ |
| æ™‚é–“ãƒœãƒ¼ãƒŠã‚¹ | `exam_results.time_bonus_points` | é€Ÿã•ã«ã‚ˆã‚‹åŠ ç‚¹ |
| æœ€çµ‚ã‚¹ã‚³ã‚¢ | `exam_results.final_score` | è‡ªå‹•è¨ˆç®—ï¼ˆãƒˆãƒªã‚¬ãƒ¼ï¼‰ |

#### å€‹äººæˆ¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°
| è¦ä»¶ | å¯¾å¿œãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»ã‚«ãƒ©ãƒ  | èª¬æ˜ |
|------|-------------------|------|
| å€‹äººé †ä½ | `exam_results.individual_rank` | æœ€çµ‚ã‚¹ã‚³ã‚¢é † |
| ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ« | `exam_results.percentile` | ä¸Šä½ä½•%ã‹ |

#### ãƒãƒ¼ãƒ æˆ¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°
| è¦ä»¶ | å¯¾å¿œãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»ã‚«ãƒ©ãƒ  | èª¬æ˜ |
|------|-------------------|------|
| ä¸Šä½4åé¸å®š | `exam_results.counted_in_team_score` | ãƒ•ãƒ©ã‚°ã§ç®¡ç† |
| ãƒãƒ¼ãƒ åˆè¨ˆã‚¹ã‚³ã‚¢ | `team_scores.total_team_score` | ä¸Šä½4åã®åˆè¨ˆ |
| ä¸Šä½4åID | `team_scores.top_member_1_id` ã€œ `top_member_4_id` | æ¡ç”¨ãƒ¡ãƒ³ãƒãƒ¼ |
| ãƒãƒ¼ãƒ é †ä½ | `team_scores.team_rank` | ãƒãƒ¼ãƒ åˆè¨ˆã‚¹ã‚³ã‚¢é † |

---

### 3. ãƒã‚¤ãƒšãƒ¼ã‚¸æ©Ÿèƒ½

| æ©Ÿèƒ½ | å¯¾å¿œãƒ†ãƒ¼ãƒ–ãƒ« | èª¬æ˜ |
|------|------------|------|
| ãƒ­ã‚°ã‚¤ãƒ³ | `users`, `user_sessions` | èªè¨¼ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† |
| ç”³è¾¼å±¥æ­´ | `applications` + `individual_applications` or `team_applications` | user_idã§çµã‚Šè¾¼ã¿ |
| æœ¬äººç¢ºèªå®Ÿæ–½ | `kyc_verifications` | Liquid eKYCã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ |
| æœ¬äººç¢ºèªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | `applications.kyc_status` or `team_members.kyc_status` | ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º |
| æ±ºæ¸ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | `applications.payment_status` or `team_members.payment_status` | æ”¯æ‰•ã„æ¸ˆã¿ã‹ç¢ºèª |
| è©¦é¨“çµæœç¢ºèª | `exam_results` | results_published=TRUEã®ã¿è¡¨ç¤º |
| é€šçŸ¥ | `notifications` | æ”¯æ‰•ã„è¦æ±‚ã€æœ¬äººç¢ºèªè¦æ±‚ç­‰ |

---

### 4. Liquid eKYCé€£æº

| ãƒ•ã‚§ãƒ¼ã‚º | å¯¾å¿œã‚«ãƒ©ãƒ ãƒ»ãƒ†ãƒ¼ãƒ–ãƒ« | èª¬æ˜ |
|---------|-------------------|------|
| eKYCé–‹å§‹ | `kyc_verifications.verification_url` | Liquid eKYCã®URL |
| é€²è¡Œä¸­ | `kyc_verifications.verification_status = 'in_progress'` | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–° |
| å®Œäº† | `kyc_verifications.completed_at`, `verified_name`, `face_verified`ç­‰ | Liquidã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ä¿å­˜ |
| ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆ | `applications.kyc_status = 'completed'` | ãƒ•ãƒ©ã‚°æ›´æ–°å¾Œã€ãƒã‚¤ãƒšãƒ¼ã‚¸oræ”¯æ‰•ã„ãƒšãƒ¼ã‚¸ã¸ |
| Liquid APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ | `kyc_verifications.liquid_response_data (JSONB)` | å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ |

---

## ğŸ”„ ä¸»è¦ãªãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### ãƒ•ãƒ­ãƒ¼1: å€‹äººæˆ¦ã®ç”³è¾¼ã€œè©¦é¨“ã€œçµæœ

```
1. ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
   â†“
   applications (å‚åŠ å½¢å¼=individual, status=submitted)
   individual_applications (ç”Ÿå¾’ãƒ»ä¿è­·è€…æƒ…å ±)
   
2. æœ¬äººç¢ºèª
   â†“
   kyc_verifications (Liquid eKYCé–‹å§‹)
   applications.kyc_status = completed
   
3. Stripeæ±ºæ¸ˆ
   â†“
   payment_transactions (æ±ºæ¸ˆè¨˜éŒ²)
   applications.payment_status = completed
   applications.application_status = confirmed
   
4. è©¦é¨“å®Ÿæ–½
   â†“
   applications.exam_status = in_progress
   user_answers (å•é¡Œã”ã¨ã®å›ç­”ãƒ»æ™‚é–“)
   applications.exam_status = completed
   
5. ã‚¹ã‚³ã‚¢è¨ˆç®—
   â†“
   exam_results (æ­£ç­”ç‚¹ + æ™‚é–“ãƒœãƒ¼ãƒŠã‚¹ = æœ€çµ‚ã‚¹ã‚³ã‚¢)
   exam_results.individual_rank (é †ä½ä»˜ã‘)
   
6. çµæœå…¬é–‹
   â†“
   exam_results.results_published = TRUE
   notifications (çµæœå…¬é–‹é€šçŸ¥)
   email_logs (çµæœé€šçŸ¥ãƒ¡ãƒ¼ãƒ«)
```

### ãƒ•ãƒ­ãƒ¼2: ãƒãƒ¼ãƒ æˆ¦ã®ç”³è¾¼ã€œæ±ºæ¸ˆå®Œäº†

```
1. ä»£è¡¨è€…ãŒç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
   â†“
   applications (å‚åŠ å½¢å¼=team, status=submitted)
   team_applications (ãƒãƒ¼ãƒ åã€å­¦æ ¡ã€ä¿è­·è€…æƒ…å ±)
   team_members Ã— 5 (ãƒ¡ãƒ³ãƒãƒ¼1ã€œ5ã®æ°åãƒ»ãƒ¡ãƒ¼ãƒ«)
   
2. ä»£è¡¨è€…ã®æœ¬äººç¢ºèªãƒ»æ±ºæ¸ˆ
   â†“
   kyc_verifications (ä»£è¡¨è€…, application_idç´ä»˜ã‘)
   applications.kyc_status = completed
   payment_transactions (ä»£è¡¨è€…, application_idç´ä»˜ã‘)
   applications.payment_status = completed
   
3. ãƒ¡ãƒ³ãƒãƒ¼2ã€œ5ã«æ”¯æ‰•ã„ä¾é ¼ãƒ¡ãƒ¼ãƒ«é€ä¿¡
   â†“
   email_logs (type='payment_request', team_member_idç´ä»˜ã‘)
   payment_transactions.stripe_payment_link (Stripeãƒªãƒ³ã‚¯)
   team_members.payment_link_sent_at
   
4. å„ãƒ¡ãƒ³ãƒãƒ¼ãŒæ±ºæ¸ˆãƒ»æœ¬äººç¢ºèª
   â†“
   team_members.payment_status = completed
   payment_transactions (team_member_idç´ä»˜ã‘)
   team_members.kyc_status = completed
   kyc_verifications (team_member_idç´ä»˜ã‘)
   
5. å…¨å“¡å®Œäº†ãƒã‚§ãƒƒã‚¯ï¼ˆè‡ªå‹•ãƒˆãƒªã‚¬ãƒ¼ï¼‰
   â†“
   team_applications.all_members_paid = TRUE
   team_applications.all_members_kyc_completed = TRUE
   team_applications.team_ready = TRUE
   applications.application_status = confirmed
```

### ãƒ•ãƒ­ãƒ¼3: ãƒãƒ¼ãƒ æˆ¦ã®è©¦é¨“ã€œã‚¹ã‚³ã‚¢é›†è¨ˆ

```
1. ãƒ¡ãƒ³ãƒãƒ¼5åãã‚Œãã‚ŒãŒè©¦é¨“å®Ÿæ–½
   â†“
   team_members.exam_participated = TRUE
   user_answers (å„ãƒ¡ãƒ³ãƒãƒ¼ã®å›ç­”, team_member_idç´ä»˜ã‘)
   
2. å„ãƒ¡ãƒ³ãƒãƒ¼ã®ã‚¹ã‚³ã‚¢è¨ˆç®—
   â†“
   exam_results (team_member_idç´ä»˜ã‘) Ã— 5
   
3. ãƒãƒ¼ãƒ ä¸Šä½4åã®é¸å®š
   â†“
   exam_results.final_score ã‚’é™é †ã‚½ãƒ¼ãƒˆ
   ä¸Šä½4åã« exam_results.counted_in_team_score = TRUE
   
4. ãƒãƒ¼ãƒ åˆè¨ˆã‚¹ã‚³ã‚¢ã®è¨ˆç®—
   â†“
   team_scores.total_team_score (ä¸Šä½4åã®åˆè¨ˆ)
   team_scores.top_member_1_id ã€œ top_member_4_id
   
5. ãƒãƒ¼ãƒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç®—å‡º
   â†“
   team_scores.team_rank (å…¨ãƒãƒ¼ãƒ ä¸­ã®é †ä½)
```

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ

### Row Level Security (RLS) ãƒãƒªã‚·ãƒ¼

| ãƒ†ãƒ¼ãƒ–ãƒ« | ãƒãƒªã‚·ãƒ¼å†…å®¹ |
|---------|------------|
| `users` | è‡ªåˆ†ã®æƒ…å ±ã®ã¿é–²è¦§ãƒ»æ›´æ–°å¯èƒ½ |
| `applications` | è‡ªåˆ†ã®ç”³è¾¼ã®ã¿é–²è¦§å¯èƒ½ |
| `questions` | èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å…¬é–‹å•é¡Œã‚’é–²è¦§å¯èƒ½ |
| `user_answers` | è‡ªåˆ†ã®å›ç­”ã®ã¿é–²è¦§ãƒ»ä½œæˆå¯èƒ½ |
| `exam_results` | è‡ªåˆ†ã®çµæœã®ã¿é–²è¦§å¯èƒ½ï¼ˆå…¬é–‹å¾Œã®ã¿ï¼‰ |
| `notifications` | è‡ªåˆ†å®›ã®é€šçŸ¥ã®ã¿é–²è¦§ãƒ»æ›´æ–°å¯èƒ½ |

### ç®¡ç†è€…æ¨©é™

- `admin_activity_logs` ã§å…¨ã¦ã®æ“ä½œã‚’è¨˜éŒ²
- ç®¡ç†è€…ã¯å…¨ãƒ‡ãƒ¼ã‚¿ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼ˆRLSé™¤å¤–ï¼‰

---

## ğŸš€ è‡ªå‹•åŒ–æ©Ÿèƒ½ï¼ˆãƒˆãƒªã‚¬ãƒ¼ï¼‰

| ãƒˆãƒªã‚¬ãƒ¼ | ç™ºå‹•æ¡ä»¶ | å‡¦ç†å†…å®¹ |
|---------|---------|---------|
| `generate_application_number_trigger` | applications INSERTæ™‚ | ç”³è¾¼ç•ªå·ã‚’è‡ªå‹•ç”Ÿæˆï¼ˆAPP-2025-00001å½¢å¼ï¼‰ |
| `update_updated_at` | å„ãƒ†ãƒ¼ãƒ–ãƒ« UPDATEæ™‚ | updated_atã‚’ç¾åœ¨æ™‚åˆ»ã«è‡ªå‹•æ›´æ–° |
| `update_team_status` | team_members.payment_status / kyc_status UPDATEæ™‚ | team_applications.all_members_paid ç­‰ã‚’è‡ªå‹•æ›´æ–° |
| `calculate_final_score` | exam_results.total_points / time_bonus_points UPDATEæ™‚ | final_score ã‚’è‡ªå‹•è¨ˆç®— |

---

## ğŸ“ˆ ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£

### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆ

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãŸã‚ã«ä»¥ä¸‹ã®ã‚«ãƒ©ãƒ ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¨­å®šï¼š

- **æ¤œç´¢é »åº¦ãŒé«˜ã„ã‚«ãƒ©ãƒ **: user_id, application_id, team_member_id
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ©ãƒ **: payment_status, kyc_status, application_status
- **ã‚½ãƒ¼ãƒˆç”¨ã‚«ãƒ©ãƒ **: final_score DESC, individual_rank
- **æ—¥æ™‚ã‚«ãƒ©ãƒ **: created_at DESC

### JSONBæ´»ç”¨

- `kyc_verifications.liquid_response_data`: Liquid APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å…¨ä½“ã‚’ä¿å­˜
- `admin_activity_logs.changes`: å¤‰æ›´å†…å®¹ã®è©³ç´°ã‚’ä¿å­˜
- æŸ”è»Ÿãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ã§å°†æ¥ã®æ‹¡å¼µã«å¯¾å¿œ

---

## âœ… DBè¨­è¨ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ç”³è¾¼ãƒ»æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼
- âœ… å€‹äººæˆ¦ã®ç”³è¾¼ãƒ»æ±ºæ¸ˆãƒ»æœ¬äººç¢ºèª
- âœ… ãƒãƒ¼ãƒ æˆ¦ä»£è¡¨è€…ã®ç”³è¾¼ãƒ»æ±ºæ¸ˆãƒ»æœ¬äººç¢ºèª
- âœ… ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼å€‹åˆ¥ã®æ±ºæ¸ˆãƒ»æœ¬äººç¢ºèª
- âœ… ãƒãƒ¼ãƒ å…¨ä½“ã®å®Œäº†çŠ¶æ…‹ç®¡ç†

### è©¦é¨“ã‚·ã‚¹ãƒ†ãƒ 
- âœ… å•é¡Œãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼å›ç­”ã®è¨˜éŒ²
- âœ… è§£ç­”æ™‚é–“ã®è¨ˆæ¸¬
- âœ… ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼ˆæ­£ç­”ç‚¹ + æ™‚é–“ãƒœãƒ¼ãƒŠã‚¹ï¼‰
- âœ… å€‹äººæˆ¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°
- âœ… ãƒãƒ¼ãƒ æˆ¦ã‚¹ã‚³ã‚¢é›†è¨ˆï¼ˆä¸Šä½4åï¼‰
- âœ… ãƒãƒ¼ãƒ æˆ¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°

### ãƒã‚¤ãƒšãƒ¼ã‚¸
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- âœ… ç”³è¾¼å±¥æ­´è¡¨ç¤º
- âœ… æœ¬äººç¢ºèªå®Ÿæ–½ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
- âœ… æ±ºæ¸ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
- âœ… è©¦é¨“çµæœç¢ºèª
- âœ… é€šçŸ¥æ©Ÿèƒ½

### Liquid eKYCé€£æº
- âœ… eKYC URLç®¡ç†
- âœ… æœ¬äººç¢ºèªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
- âœ… æœ¬äººç¢ºèªæ›¸é¡æƒ…å ±ä¿å­˜
- âœ… Liquid APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¿å­˜ï¼ˆJSONBï¼‰
- âœ… ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå¯¾å¿œ

### ç®¡ç†æ©Ÿèƒ½
- âœ… ç®¡ç†è€…æ“ä½œãƒ­ã‚°
- âœ… ãƒ¡ãƒ¼ãƒ«é€ä¿¡å±¥æ­´
- âœ… æ±ºæ¸ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å±¥æ­´

---

## ğŸ”„ ä»Šå¾Œã®æ‹¡å¼µå¯èƒ½æ€§

ã“ã®DBè¨­è¨ˆã¯ä»¥ä¸‹ã®æ‹¡å¼µã«å¯¾å¿œå¯èƒ½ï¼š

1. **è¤‡æ•°å¹´åº¦ã®è©¦é¨“å¯¾å¿œ**
   - `questions.exam_year` ã§å¹´åº¦ç®¡ç†

2. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°**
   - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ€é©åŒ–æ¸ˆã¿

3. **ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥åˆ†æ**
   - `questions.category` ã§ã‚«ãƒ†ã‚´ãƒªãƒ¼ç®¡ç†
   - `exam_results` ã«ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã‚¹ã‚³ã‚¢

4. **è³å“ãƒ»ç ”ä¿®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ç®¡ç†**
   - `exam_results.prize_eligible`, `cambridge_program_eligible`

5. **é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ **
   - `notifications` ãƒ†ãƒ¼ãƒ–ãƒ«ã§æŸ”è»Ÿãªé€šçŸ¥ç®¡ç†

6. **å¤šè¨€èªå¯¾å¿œ**
   - `questions` ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¨€èªã‚«ãƒ©ãƒ è¿½åŠ å¯èƒ½

---

ã“ã®DBè¨­è¨ˆã§è¦ä»¶ã‚’å…¨ã¦ã‚«ãƒãƒ¼ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ
è¿½åŠ ãƒ»ä¿®æ­£ãŒå¿…è¦ãªç‚¹ãŒã‚ã‚Œã°ãŠçŸ¥ã‚‰ã›ãã ã•ã„ï¼

